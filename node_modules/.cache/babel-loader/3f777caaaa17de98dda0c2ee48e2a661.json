{"ast":null,"code":"/*! Source code licensed under Apache License 2.0. Copyright © 2017-current William Ngan and contributors. (https://github.com/williamngan/pts) */\nimport { Pt, Bound } from \"./Pt\";\nimport { UIPointerActions as UIA } from \"./UI\";\nexport class Space {\n  constructor() {\n    this.id = \"space\";\n    this.bound = new Bound();\n    this._time = {\n      prev: 0,\n      diff: 0,\n      end: -1\n    };\n    this.players = {};\n    this.playerCount = 0;\n    this._animID = -1;\n    this._pause = false;\n    this._refresh = undefined;\n    this._pointer = new Pt();\n    this._isReady = false;\n    this._playing = false;\n  }\n\n  refresh(b) {\n    this._refresh = b;\n    return this;\n  }\n\n  add(p) {\n    let player = typeof p == \"function\" ? {\n      animate: p\n    } : p;\n    let k = this.playerCount++;\n    let pid = this.id + k;\n    this.players[pid] = player;\n    player.animateID = pid;\n    if (player.resize && this.bound.inited) player.resize(this.bound);\n    if (this._refresh === undefined) this._refresh = true;\n    return this;\n  }\n\n  remove(player) {\n    delete this.players[player.animateID];\n    return this;\n  }\n\n  removeAll() {\n    this.players = {};\n    return this;\n  }\n\n  play(time = 0) {\n    if (time === 0 && this._animID !== -1) {\n      return;\n    }\n\n    this._animID = requestAnimationFrame(this.play.bind(this));\n    if (this._pause) return this;\n    this._time.diff = time - this._time.prev;\n    this._time.prev = time;\n\n    try {\n      this.playItems(time);\n    } catch (err) {\n      cancelAnimationFrame(this._animID);\n      this._animID = -1;\n      this._playing = false;\n      throw err;\n    }\n\n    return this;\n  }\n\n  replay() {\n    this._time.end = -1;\n    this.play();\n  }\n\n  playItems(time) {\n    this._playing = true;\n    if (this._refresh) this.clear();\n\n    if (this._isReady) {\n      for (let k in this.players) {\n        if (this.players[k].animate) this.players[k].animate(time, this._time.diff, this);\n      }\n    }\n\n    if (this._time.end >= 0 && time > this._time.end) {\n      cancelAnimationFrame(this._animID);\n      this._animID = -1;\n      this._playing = false;\n    }\n  }\n\n  pause(toggle = false) {\n    this._pause = toggle ? !this._pause : true;\n    return this;\n  }\n\n  resume() {\n    this._pause = false;\n    return this;\n  }\n\n  stop(t = 0) {\n    this._time.end = t;\n    return this;\n  }\n\n  playOnce(duration = 5000) {\n    this.play();\n    this.stop(duration);\n    return this;\n  }\n\n  render(context) {\n    if (this._renderFunc) this._renderFunc(context, this);\n    return this;\n  }\n\n  set customRendering(f) {\n    this._renderFunc = f;\n  }\n\n  get customRendering() {\n    return this._renderFunc;\n  }\n\n  get isPlaying() {\n    return this._playing;\n  }\n\n  get outerBound() {\n    return this.bound.clone();\n  }\n\n  get innerBound() {\n    return new Bound(Pt.make(this.size.length, 0), this.size.clone());\n  }\n\n  get size() {\n    return this.bound.size.clone();\n  }\n\n  get center() {\n    return this.size.divide(2);\n  }\n\n  get width() {\n    return this.bound.width;\n  }\n\n  get height() {\n    return this.bound.height;\n  }\n\n}\nexport class MultiTouchSpace extends Space {\n  constructor() {\n    super(...arguments);\n    this._pressed = false;\n    this._dragged = false;\n    this._hasMouse = false;\n    this._hasTouch = false;\n  }\n\n  get pointer() {\n    let p = this._pointer.clone();\n\n    p.id = this._pointer.id;\n    return p;\n  }\n\n  bindCanvas(evt, callback) {\n    this._canvas.addEventListener(evt, callback);\n  }\n\n  unbindCanvas(evt, callback) {\n    this._canvas.removeEventListener(evt, callback);\n  }\n\n  bindMouse(_bind = true) {\n    if (_bind) {\n      this.bindCanvas(\"mousedown\", this._mouseDown.bind(this));\n      this.bindCanvas(\"mouseup\", this._mouseUp.bind(this));\n      this.bindCanvas(\"mouseover\", this._mouseOver.bind(this));\n      this.bindCanvas(\"mouseout\", this._mouseOut.bind(this));\n      this.bindCanvas(\"mousemove\", this._mouseMove.bind(this));\n      this.bindCanvas(\"contextmenu\", this._contextMenu.bind(this));\n      this._hasMouse = true;\n    } else {\n      this.unbindCanvas(\"mousedown\", this._mouseDown.bind(this));\n      this.unbindCanvas(\"mouseup\", this._mouseUp.bind(this));\n      this.unbindCanvas(\"mouseover\", this._mouseOver.bind(this));\n      this.unbindCanvas(\"mouseout\", this._mouseOut.bind(this));\n      this.unbindCanvas(\"mousemove\", this._mouseMove.bind(this));\n      this.unbindCanvas(\"contextmenu\", this._contextMenu.bind(this));\n      this._hasMouse = false;\n    }\n\n    return this;\n  }\n\n  bindTouch(_bind = true) {\n    if (_bind) {\n      this.bindCanvas(\"touchstart\", this._touchStart.bind(this));\n      this.bindCanvas(\"touchend\", this._mouseUp.bind(this));\n      this.bindCanvas(\"touchmove\", this._touchMove.bind(this));\n      this.bindCanvas(\"touchcancel\", this._mouseOut.bind(this));\n      this._hasTouch = true;\n    } else {\n      this.unbindCanvas(\"touchstart\", this._touchStart.bind(this));\n      this.unbindCanvas(\"touchend\", this._mouseUp.bind(this));\n      this.unbindCanvas(\"touchmove\", this._touchMove.bind(this));\n      this.unbindCanvas(\"touchcancel\", this._mouseOut.bind(this));\n      this._hasTouch = false;\n    }\n\n    return this;\n  }\n\n  touchesToPoints(evt, which = \"touches\") {\n    if (!evt || !evt[which]) return [];\n    let ts = [];\n\n    for (var i = 0; i < evt[which].length; i++) {\n      let t = evt[which].item(i);\n      ts.push(new Pt(t.pageX - this.bound.topLeft.x, t.pageY - this.bound.topLeft.y));\n    }\n\n    return ts;\n  }\n\n  _mouseAction(type, evt) {\n    let px = 0,\n        py = 0;\n\n    if (evt instanceof MouseEvent) {\n      for (let k in this.players) {\n        if (this.players.hasOwnProperty(k)) {\n          let v = this.players[k];\n          px = evt.pageX - this.outerBound.x;\n          py = evt.pageY - this.outerBound.y;\n          if (v.action) v.action(type, px, py, evt);\n        }\n      }\n    } else {\n      for (let k in this.players) {\n        if (this.players.hasOwnProperty(k)) {\n          let v = this.players[k];\n          let c = evt.changedTouches && evt.changedTouches.length > 0;\n          let touch = evt.changedTouches.item(0);\n          px = c ? touch.pageX - this.outerBound.x : 0;\n          py = c ? touch.pageY - this.outerBound.y : 0;\n          if (v.action) v.action(type, px, py, evt);\n        }\n      }\n    }\n\n    if (type) {\n      this._pointer.to(px, py);\n\n      this._pointer.id = type;\n    }\n  }\n\n  _mouseDown(evt) {\n    this._mouseAction(UIA.down, evt);\n\n    this._pressed = true;\n    return false;\n  }\n\n  _mouseUp(evt) {\n    if (this._dragged) {\n      this._mouseAction(UIA.drop, evt);\n    } else {\n      this._mouseAction(UIA.up, evt);\n    }\n\n    this._pressed = false;\n    this._dragged = false;\n    return false;\n  }\n\n  _mouseMove(evt) {\n    this._mouseAction(UIA.move, evt);\n\n    if (this._pressed) {\n      this._dragged = true;\n\n      this._mouseAction(UIA.drag, evt);\n    }\n\n    return false;\n  }\n\n  _mouseOver(evt) {\n    this._mouseAction(UIA.over, evt);\n\n    return false;\n  }\n\n  _mouseOut(evt) {\n    this._mouseAction(UIA.out, evt);\n\n    if (this._dragged) this._mouseAction(UIA.drop, evt);\n    this._dragged = false;\n    return false;\n  }\n\n  _contextMenu(evt) {\n    this._mouseAction(UIA.contextmenu, evt);\n\n    return false;\n  }\n\n  _touchMove(evt) {\n    this._mouseMove(evt);\n\n    evt.preventDefault();\n    return false;\n  }\n\n  _touchStart(evt) {\n    this._mouseDown(evt);\n\n    evt.preventDefault();\n    return false;\n  }\n\n}","map":{"version":3,"sources":["/Users/erickoduniyi/Desktop/Work/multi_media_signal_processing/skeuomorphic-synth-master/node_modules/pts/dist/es2015/Space.js"],"names":["Pt","Bound","UIPointerActions","UIA","Space","constructor","id","bound","_time","prev","diff","end","players","playerCount","_animID","_pause","_refresh","undefined","_pointer","_isReady","_playing","refresh","b","add","p","player","animate","k","pid","animateID","resize","inited","remove","removeAll","play","time","requestAnimationFrame","bind","playItems","err","cancelAnimationFrame","replay","clear","pause","toggle","resume","stop","t","playOnce","duration","render","context","_renderFunc","customRendering","f","isPlaying","outerBound","clone","innerBound","make","size","length","center","divide","width","height","MultiTouchSpace","arguments","_pressed","_dragged","_hasMouse","_hasTouch","pointer","bindCanvas","evt","callback","_canvas","addEventListener","unbindCanvas","removeEventListener","bindMouse","_bind","_mouseDown","_mouseUp","_mouseOver","_mouseOut","_mouseMove","_contextMenu","bindTouch","_touchStart","_touchMove","touchesToPoints","which","ts","i","item","push","pageX","topLeft","x","pageY","y","_mouseAction","type","px","py","MouseEvent","hasOwnProperty","v","action","c","changedTouches","touch","to","down","drop","up","move","drag","over","out","contextmenu","preventDefault"],"mappings":"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","sourcesContent":["/*! Source code licensed under Apache License 2.0. Copyright © 2017-current William Ngan and contributors. (https://github.com/williamngan/pts) */\nimport { Pt, Bound } from \"./Pt\";\nimport { UIPointerActions as UIA } from \"./UI\";\nexport class Space {\n    constructor() {\n        this.id = \"space\";\n        this.bound = new Bound();\n        this._time = { prev: 0, diff: 0, end: -1 };\n        this.players = {};\n        this.playerCount = 0;\n        this._animID = -1;\n        this._pause = false;\n        this._refresh = undefined;\n        this._pointer = new Pt();\n        this._isReady = false;\n        this._playing = false;\n    }\n    refresh(b) {\n        this._refresh = b;\n        return this;\n    }\n    add(p) {\n        let player = (typeof p == \"function\") ? { animate: p } : p;\n        let k = this.playerCount++;\n        let pid = this.id + k;\n        this.players[pid] = player;\n        player.animateID = pid;\n        if (player.resize && this.bound.inited)\n            player.resize(this.bound);\n        if (this._refresh === undefined)\n            this._refresh = true;\n        return this;\n    }\n    remove(player) {\n        delete this.players[player.animateID];\n        return this;\n    }\n    removeAll() {\n        this.players = {};\n        return this;\n    }\n    play(time = 0) {\n        if (time === 0 && this._animID !== -1) {\n            return;\n        }\n        this._animID = requestAnimationFrame(this.play.bind(this));\n        if (this._pause)\n            return this;\n        this._time.diff = time - this._time.prev;\n        this._time.prev = time;\n        try {\n            this.playItems(time);\n        }\n        catch (err) {\n            cancelAnimationFrame(this._animID);\n            this._animID = -1;\n            this._playing = false;\n            throw err;\n        }\n        return this;\n    }\n    replay() {\n        this._time.end = -1;\n        this.play();\n    }\n    playItems(time) {\n        this._playing = true;\n        if (this._refresh)\n            this.clear();\n        if (this._isReady) {\n            for (let k in this.players) {\n                if (this.players[k].animate)\n                    this.players[k].animate(time, this._time.diff, this);\n            }\n        }\n        if (this._time.end >= 0 && time > this._time.end) {\n            cancelAnimationFrame(this._animID);\n            this._animID = -1;\n            this._playing = false;\n        }\n    }\n    pause(toggle = false) {\n        this._pause = (toggle) ? !this._pause : true;\n        return this;\n    }\n    resume() {\n        this._pause = false;\n        return this;\n    }\n    stop(t = 0) {\n        this._time.end = t;\n        return this;\n    }\n    playOnce(duration = 5000) {\n        this.play();\n        this.stop(duration);\n        return this;\n    }\n    render(context) {\n        if (this._renderFunc)\n            this._renderFunc(context, this);\n        return this;\n    }\n    set customRendering(f) { this._renderFunc = f; }\n    get customRendering() { return this._renderFunc; }\n    get isPlaying() { return this._playing; }\n    get outerBound() { return this.bound.clone(); }\n    get innerBound() { return new Bound(Pt.make(this.size.length, 0), this.size.clone()); }\n    get size() { return this.bound.size.clone(); }\n    get center() { return this.size.divide(2); }\n    get width() { return this.bound.width; }\n    get height() { return this.bound.height; }\n}\nexport class MultiTouchSpace extends Space {\n    constructor() {\n        super(...arguments);\n        this._pressed = false;\n        this._dragged = false;\n        this._hasMouse = false;\n        this._hasTouch = false;\n    }\n    get pointer() {\n        let p = this._pointer.clone();\n        p.id = this._pointer.id;\n        return p;\n    }\n    bindCanvas(evt, callback) {\n        this._canvas.addEventListener(evt, callback);\n    }\n    unbindCanvas(evt, callback) {\n        this._canvas.removeEventListener(evt, callback);\n    }\n    bindMouse(_bind = true) {\n        if (_bind) {\n            this.bindCanvas(\"mousedown\", this._mouseDown.bind(this));\n            this.bindCanvas(\"mouseup\", this._mouseUp.bind(this));\n            this.bindCanvas(\"mouseover\", this._mouseOver.bind(this));\n            this.bindCanvas(\"mouseout\", this._mouseOut.bind(this));\n            this.bindCanvas(\"mousemove\", this._mouseMove.bind(this));\n            this.bindCanvas(\"contextmenu\", this._contextMenu.bind(this));\n            this._hasMouse = true;\n        }\n        else {\n            this.unbindCanvas(\"mousedown\", this._mouseDown.bind(this));\n            this.unbindCanvas(\"mouseup\", this._mouseUp.bind(this));\n            this.unbindCanvas(\"mouseover\", this._mouseOver.bind(this));\n            this.unbindCanvas(\"mouseout\", this._mouseOut.bind(this));\n            this.unbindCanvas(\"mousemove\", this._mouseMove.bind(this));\n            this.unbindCanvas(\"contextmenu\", this._contextMenu.bind(this));\n            this._hasMouse = false;\n        }\n        return this;\n    }\n    bindTouch(_bind = true) {\n        if (_bind) {\n            this.bindCanvas(\"touchstart\", this._touchStart.bind(this));\n            this.bindCanvas(\"touchend\", this._mouseUp.bind(this));\n            this.bindCanvas(\"touchmove\", this._touchMove.bind(this));\n            this.bindCanvas(\"touchcancel\", this._mouseOut.bind(this));\n            this._hasTouch = true;\n        }\n        else {\n            this.unbindCanvas(\"touchstart\", this._touchStart.bind(this));\n            this.unbindCanvas(\"touchend\", this._mouseUp.bind(this));\n            this.unbindCanvas(\"touchmove\", this._touchMove.bind(this));\n            this.unbindCanvas(\"touchcancel\", this._mouseOut.bind(this));\n            this._hasTouch = false;\n        }\n        return this;\n    }\n    touchesToPoints(evt, which = \"touches\") {\n        if (!evt || !evt[which])\n            return [];\n        let ts = [];\n        for (var i = 0; i < evt[which].length; i++) {\n            let t = evt[which].item(i);\n            ts.push(new Pt(t.pageX - this.bound.topLeft.x, t.pageY - this.bound.topLeft.y));\n        }\n        return ts;\n    }\n    _mouseAction(type, evt) {\n        let px = 0, py = 0;\n        if (evt instanceof MouseEvent) {\n            for (let k in this.players) {\n                if (this.players.hasOwnProperty(k)) {\n                    let v = this.players[k];\n                    px = evt.pageX - this.outerBound.x;\n                    py = evt.pageY - this.outerBound.y;\n                    if (v.action)\n                        v.action(type, px, py, evt);\n                }\n            }\n        }\n        else {\n            for (let k in this.players) {\n                if (this.players.hasOwnProperty(k)) {\n                    let v = this.players[k];\n                    let c = evt.changedTouches && evt.changedTouches.length > 0;\n                    let touch = evt.changedTouches.item(0);\n                    px = (c) ? touch.pageX - this.outerBound.x : 0;\n                    py = (c) ? touch.pageY - this.outerBound.y : 0;\n                    if (v.action)\n                        v.action(type, px, py, evt);\n                }\n            }\n        }\n        if (type) {\n            this._pointer.to(px, py);\n            this._pointer.id = type;\n        }\n    }\n    _mouseDown(evt) {\n        this._mouseAction(UIA.down, evt);\n        this._pressed = true;\n        return false;\n    }\n    _mouseUp(evt) {\n        if (this._dragged) {\n            this._mouseAction(UIA.drop, evt);\n        }\n        else {\n            this._mouseAction(UIA.up, evt);\n        }\n        this._pressed = false;\n        this._dragged = false;\n        return false;\n    }\n    _mouseMove(evt) {\n        this._mouseAction(UIA.move, evt);\n        if (this._pressed) {\n            this._dragged = true;\n            this._mouseAction(UIA.drag, evt);\n        }\n        return false;\n    }\n    _mouseOver(evt) {\n        this._mouseAction(UIA.over, evt);\n        return false;\n    }\n    _mouseOut(evt) {\n        this._mouseAction(UIA.out, evt);\n        if (this._dragged)\n            this._mouseAction(UIA.drop, evt);\n        this._dragged = false;\n        return false;\n    }\n    _contextMenu(evt) {\n        this._mouseAction(UIA.contextmenu, evt);\n        return false;\n    }\n    _touchMove(evt) {\n        this._mouseMove(evt);\n        evt.preventDefault();\n        return false;\n    }\n    _touchStart(evt) {\n        this._mouseDown(evt);\n        evt.preventDefault();\n        return false;\n    }\n}\n//# sourceMappingURL=Space.js.map"]},"metadata":{},"sourceType":"module"}