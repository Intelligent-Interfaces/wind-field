{"ast":null,"code":"/*! Source code licensed under Apache License 2.0. Copyright © 2017-current William Ngan and contributors. (https://github.com/williamngan/pts) */\nimport { Pt, Group } from \"./Pt\";\nimport { Rectangle, Circle, Polygon } from \"./Op\";\nexport const UIShape = {\n  rectangle: \"rectangle\",\n  circle: \"circle\",\n  polygon: \"polygon\",\n  polyline: \"polyline\",\n  line: \"line\"\n};\nexport const UIPointerActions = {\n  up: \"up\",\n  down: \"down\",\n  move: \"move\",\n  drag: \"drag\",\n  uidrag: \"uidrag\",\n  drop: \"drop\",\n  uidrop: \"uidrop\",\n  over: \"over\",\n  out: \"out\",\n  enter: \"enter\",\n  leave: \"leave\",\n  contextmenu: \"contextmenu\",\n  all: \"all\"\n};\nexport class UI {\n  constructor(group, shape, states = {}, id) {\n    this._holds = new Map();\n    this._group = Group.fromArray(group);\n    this._shape = shape;\n    this._id = id === undefined ? `ui_${UI._counter++}` : id;\n    this._states = states;\n    this._actions = {};\n  }\n\n  static fromRectangle(group, states, id) {\n    return new this(group, UIShape.rectangle, states, id);\n  }\n\n  static fromCircle(group, states, id) {\n    return new this(group, UIShape.circle, states, id);\n  }\n\n  static fromPolygon(group, states, id) {\n    return new this(group, UIShape.polygon, states, id);\n  }\n\n  static fromUI(ui, states, id) {\n    return new this(ui.group, ui.shape, states || ui._states, id);\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  set id(d) {\n    this._id = d;\n  }\n\n  get group() {\n    return this._group;\n  }\n\n  set group(d) {\n    this._group = d;\n  }\n\n  get shape() {\n    return this._shape;\n  }\n\n  set shape(d) {\n    this._shape = d;\n  }\n\n  state(key, value) {\n    if (!key) return null;\n\n    if (value !== undefined) {\n      this._states[key] = value;\n      return this;\n    }\n\n    return this._states[key];\n  }\n\n  on(type, fn) {\n    if (!this._actions[type]) this._actions[type] = [];\n    return UI._addHandler(this._actions[type], fn);\n  }\n\n  off(type, which) {\n    if (!this._actions[type]) return false;\n\n    if (which === undefined) {\n      delete this._actions[type];\n      return true;\n    } else {\n      return UI._removeHandler(this._actions[type], which);\n    }\n  }\n\n  listen(type, p, evt) {\n    if (this._actions[type] !== undefined) {\n      if (this._within(p) || Array.from(this._holds.values()).indexOf(type) >= 0) {\n        UI._trigger(this._actions[type], this, p, type, evt);\n\n        return true;\n      } else if (this._actions['all']) {\n        UI._trigger(this._actions['all'], this, p, type, evt);\n\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  hold(type) {\n    let newKey = Math.max(0, ...Array.from(this._holds.keys())) + 1;\n\n    this._holds.set(newKey, type);\n\n    return newKey;\n  }\n\n  unhold(key) {\n    if (key !== undefined) {\n      this._holds.delete(key);\n    } else {\n      this._holds.clear();\n    }\n  }\n\n  static track(uis, type, p, evt) {\n    for (let i = 0, len = uis.length; i < len; i++) {\n      uis[i].listen(type, p, evt);\n    }\n  }\n\n  render(fn) {\n    fn(this._group, this._states);\n  }\n\n  toString() {\n    return `UI ${this.group.toString}`;\n  }\n\n  _within(p) {\n    let fn = null;\n\n    if (this._shape === UIShape.rectangle) {\n      fn = Rectangle.withinBound;\n    } else if (this._shape === UIShape.circle) {\n      fn = Circle.withinBound;\n    } else if (this._shape === UIShape.polygon) {\n      fn = Polygon.hasIntersectPoint;\n    } else {\n      return false;\n    }\n\n    return fn(this._group, p);\n  }\n\n  static _trigger(fns, target, pt, type, evt) {\n    if (fns) {\n      for (let i = 0, len = fns.length; i < len; i++) {\n        if (fns[i]) fns[i](target, pt, type, evt);\n      }\n    }\n  }\n\n  static _addHandler(fns, fn) {\n    if (fn) {\n      fns.push(fn);\n      return fns.length - 1;\n    } else {\n      return -1;\n    }\n  }\n\n  static _removeHandler(fns, index) {\n    if (index >= 0 && index < fns.length) {\n      let temp = fns.length;\n      fns.splice(index, 1);\n      return temp > fns.length;\n    } else {\n      return false;\n    }\n  }\n\n}\nUI._counter = 0;\nexport class UIButton extends UI {\n  constructor(group, shape, states = {}, id) {\n    super(group, shape, states, id);\n    this._hoverID = -1;\n    if (states.hover === undefined) this._states['hover'] = false;\n    if (states.clicks === undefined) this._states['clicks'] = 0;\n    const UA = UIPointerActions;\n    this.on(UA.up, (target, pt, type, evt) => {\n      this.state('clicks', this._states.clicks + 1);\n    });\n    this.on(UA.move, (target, pt, type, evt) => {\n      let hover = this._within(pt);\n\n      if (hover && !this._states.hover) {\n        this.state('hover', true);\n\n        UI._trigger(this._actions[UA.enter], this, pt, UA.enter, evt);\n\n        var _capID = this.hold(UA.move);\n\n        this._hoverID = this.on(UA.move, (t, p) => {\n          if (!this._within(p) && !this.state('dragging')) {\n            this.state('hover', false);\n\n            UI._trigger(this._actions[UA.leave], this, pt, UA.leave, evt);\n\n            this.off(UA.move, this._hoverID);\n            this.unhold(_capID);\n          }\n        });\n      }\n    });\n  }\n\n  onClick(fn) {\n    return this.on(UIPointerActions.up, fn);\n  }\n\n  offClick(id) {\n    return this.off(UIPointerActions.up, id);\n  }\n\n  onContextMenu(fn) {\n    return this.on(UIPointerActions.contextmenu, fn);\n  }\n\n  offContextMenu(id) {\n    return this.off(UIPointerActions.contextmenu, id);\n  }\n\n  onHover(enter, leave) {\n    var ids = [undefined, undefined];\n    if (enter) ids[0] = this.on(UIPointerActions.enter, enter);\n    if (leave) ids[1] = this.on(UIPointerActions.leave, leave);\n    return ids;\n  }\n\n  offHover(enterID, leaveID) {\n    var s = [false, false];\n    if (enterID === undefined || enterID >= 0) s[0] = this.off(UIPointerActions.enter, enterID);\n    if (leaveID === undefined || leaveID >= 0) s[1] = this.off(UIPointerActions.leave, leaveID);\n    return s;\n  }\n\n}\nexport class UIDragger extends UIButton {\n  constructor(group, shape, states = {}, id) {\n    super(group, shape, states, id);\n    this._draggingID = -1;\n    this._moveHoldID = -1;\n    this._dropHoldID = -1;\n    this._upHoldID = -1;\n    if (states.dragging === undefined) this._states['dragging'] = false;\n    if (states.moved === undefined) this._states['moved'] = false;\n    if (states.offset === undefined) this._states['offset'] = new Pt();\n    const UA = UIPointerActions;\n    this.on(UA.down, (target, pt, type, evt) => {\n      if (this._moveHoldID === -1) {\n        this.state('dragging', true);\n        this.state('offset', new Pt(pt).subtract(target.group[0]));\n        this._moveHoldID = this.hold(UA.move);\n      }\n\n      if (this._dropHoldID === -1) {\n        this._dropHoldID = this.hold(UA.drop);\n      }\n\n      if (this._upHoldID === -1) {\n        this._upHoldID = this.hold(UA.up);\n      }\n\n      if (this._draggingID === -1) {\n        this._draggingID = this.on(UA.move, (t, p) => {\n          if (this.state('dragging')) {\n            UI._trigger(this._actions[UA.uidrag], t, p, UA.uidrag, evt);\n\n            this.state('moved', true);\n          }\n        });\n      }\n    });\n\n    const endDrag = (target, pt, type, evt) => {\n      this.state('dragging', false);\n      this.off(UA.move, this._draggingID);\n      this._draggingID = -1;\n      this.unhold(this._moveHoldID);\n      this._moveHoldID = -1;\n      this.unhold(this._dropHoldID);\n      this._dropHoldID = -1;\n      this.unhold(this._upHoldID);\n      this._upHoldID = -1;\n\n      if (this.state('moved')) {\n        UI._trigger(this._actions[UA.uidrop], target, pt, UA.uidrop, evt);\n\n        this.state('moved', false);\n      }\n    };\n\n    this.on(UA.drop, endDrag);\n    this.on(UA.up, endDrag);\n    this.on(UA.out, endDrag);\n  }\n\n  onDrag(fn) {\n    return this.on(UIPointerActions.uidrag, fn);\n  }\n\n  offDrag(id) {\n    return this.off(UIPointerActions.uidrag, id);\n  }\n\n  onDrop(fn) {\n    return this.on(UIPointerActions.uidrop, fn);\n  }\n\n  offDrop(id) {\n    return this.off(UIPointerActions.uidrop, id);\n  }\n\n}","map":{"version":3,"sources":["/Users/erickoduniyi/Desktop/Work/multi_media_signal_processing/skeuomorphic-synth-master/node_modules/pts/dist/es2015/UI.js"],"names":["Pt","Group","Rectangle","Circle","Polygon","UIShape","rectangle","circle","polygon","polyline","line","UIPointerActions","up","down","move","drag","uidrag","drop","uidrop","over","out","enter","leave","contextmenu","all","UI","constructor","group","shape","states","id","_holds","Map","_group","fromArray","_shape","_id","undefined","_counter","_states","_actions","fromRectangle","fromCircle","fromPolygon","fromUI","ui","d","state","key","value","on","type","fn","_addHandler","off","which","_removeHandler","listen","p","evt","_within","Array","from","values","indexOf","_trigger","hold","newKey","Math","max","keys","set","unhold","delete","clear","track","uis","i","len","length","render","toString","withinBound","hasIntersectPoint","fns","target","pt","push","index","temp","splice","UIButton","_hoverID","hover","clicks","UA","_capID","t","onClick","offClick","onContextMenu","offContextMenu","onHover","ids","offHover","enterID","leaveID","s","UIDragger","_draggingID","_moveHoldID","_dropHoldID","_upHoldID","dragging","moved","offset","subtract","endDrag","onDrag","offDrag","onDrop","offDrop"],"mappings":"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","sourcesContent":["/*! Source code licensed under Apache License 2.0. Copyright © 2017-current William Ngan and contributors. (https://github.com/williamngan/pts) */\nimport { Pt, Group } from \"./Pt\";\nimport { Rectangle, Circle, Polygon } from \"./Op\";\nexport const UIShape = {\n    rectangle: \"rectangle\", circle: \"circle\", polygon: \"polygon\", polyline: \"polyline\", line: \"line\"\n};\nexport const UIPointerActions = {\n    up: \"up\", down: \"down\", move: \"move\", drag: \"drag\", uidrag: \"uidrag\", drop: \"drop\", uidrop: \"uidrop\", over: \"over\", out: \"out\", enter: \"enter\", leave: \"leave\", contextmenu: \"contextmenu\", all: \"all\"\n};\nexport class UI {\n    constructor(group, shape, states = {}, id) {\n        this._holds = new Map();\n        this._group = Group.fromArray(group);\n        this._shape = shape;\n        this._id = id === undefined ? `ui_${(UI._counter++)}` : id;\n        this._states = states;\n        this._actions = {};\n    }\n    static fromRectangle(group, states, id) {\n        return new this(group, UIShape.rectangle, states, id);\n    }\n    static fromCircle(group, states, id) {\n        return new this(group, UIShape.circle, states, id);\n    }\n    static fromPolygon(group, states, id) {\n        return new this(group, UIShape.polygon, states, id);\n    }\n    static fromUI(ui, states, id) {\n        return new this(ui.group, ui.shape, states || ui._states, id);\n    }\n    get id() { return this._id; }\n    set id(d) { this._id = d; }\n    get group() { return this._group; }\n    set group(d) { this._group = d; }\n    get shape() { return this._shape; }\n    set shape(d) { this._shape = d; }\n    state(key, value) {\n        if (!key)\n            return null;\n        if (value !== undefined) {\n            this._states[key] = value;\n            return this;\n        }\n        return this._states[key];\n    }\n    on(type, fn) {\n        if (!this._actions[type])\n            this._actions[type] = [];\n        return UI._addHandler(this._actions[type], fn);\n    }\n    off(type, which) {\n        if (!this._actions[type])\n            return false;\n        if (which === undefined) {\n            delete this._actions[type];\n            return true;\n        }\n        else {\n            return UI._removeHandler(this._actions[type], which);\n        }\n    }\n    listen(type, p, evt) {\n        if (this._actions[type] !== undefined) {\n            if (this._within(p) || Array.from(this._holds.values()).indexOf(type) >= 0) {\n                UI._trigger(this._actions[type], this, p, type, evt);\n                return true;\n            }\n            else if (this._actions['all']) {\n                UI._trigger(this._actions['all'], this, p, type, evt);\n                return true;\n            }\n        }\n        return false;\n    }\n    hold(type) {\n        let newKey = Math.max(0, ...Array.from(this._holds.keys())) + 1;\n        this._holds.set(newKey, type);\n        return newKey;\n    }\n    unhold(key) {\n        if (key !== undefined) {\n            this._holds.delete(key);\n        }\n        else {\n            this._holds.clear();\n        }\n    }\n    static track(uis, type, p, evt) {\n        for (let i = 0, len = uis.length; i < len; i++) {\n            uis[i].listen(type, p, evt);\n        }\n    }\n    render(fn) {\n        fn(this._group, this._states);\n    }\n    toString() {\n        return `UI ${this.group.toString}`;\n    }\n    _within(p) {\n        let fn = null;\n        if (this._shape === UIShape.rectangle) {\n            fn = Rectangle.withinBound;\n        }\n        else if (this._shape === UIShape.circle) {\n            fn = Circle.withinBound;\n        }\n        else if (this._shape === UIShape.polygon) {\n            fn = Polygon.hasIntersectPoint;\n        }\n        else {\n            return false;\n        }\n        return fn(this._group, p);\n    }\n    static _trigger(fns, target, pt, type, evt) {\n        if (fns) {\n            for (let i = 0, len = fns.length; i < len; i++) {\n                if (fns[i])\n                    fns[i](target, pt, type, evt);\n            }\n        }\n    }\n    static _addHandler(fns, fn) {\n        if (fn) {\n            fns.push(fn);\n            return fns.length - 1;\n        }\n        else {\n            return -1;\n        }\n    }\n    static _removeHandler(fns, index) {\n        if (index >= 0 && index < fns.length) {\n            let temp = fns.length;\n            fns.splice(index, 1);\n            return (temp > fns.length);\n        }\n        else {\n            return false;\n        }\n    }\n}\nUI._counter = 0;\nexport class UIButton extends UI {\n    constructor(group, shape, states = {}, id) {\n        super(group, shape, states, id);\n        this._hoverID = -1;\n        if (states.hover === undefined)\n            this._states['hover'] = false;\n        if (states.clicks === undefined)\n            this._states['clicks'] = 0;\n        const UA = UIPointerActions;\n        this.on(UA.up, (target, pt, type, evt) => {\n            this.state('clicks', this._states.clicks + 1);\n        });\n        this.on(UA.move, (target, pt, type, evt) => {\n            let hover = this._within(pt);\n            if (hover && !this._states.hover) {\n                this.state('hover', true);\n                UI._trigger(this._actions[UA.enter], this, pt, UA.enter, evt);\n                var _capID = this.hold(UA.move);\n                this._hoverID = this.on(UA.move, (t, p) => {\n                    if (!this._within(p) && !this.state('dragging')) {\n                        this.state('hover', false);\n                        UI._trigger(this._actions[UA.leave], this, pt, UA.leave, evt);\n                        this.off(UA.move, this._hoverID);\n                        this.unhold(_capID);\n                    }\n                });\n            }\n        });\n    }\n    onClick(fn) {\n        return this.on(UIPointerActions.up, fn);\n    }\n    offClick(id) {\n        return this.off(UIPointerActions.up, id);\n    }\n    onContextMenu(fn) {\n        return this.on(UIPointerActions.contextmenu, fn);\n    }\n    offContextMenu(id) {\n        return this.off(UIPointerActions.contextmenu, id);\n    }\n    onHover(enter, leave) {\n        var ids = [undefined, undefined];\n        if (enter)\n            ids[0] = this.on(UIPointerActions.enter, enter);\n        if (leave)\n            ids[1] = this.on(UIPointerActions.leave, leave);\n        return ids;\n    }\n    offHover(enterID, leaveID) {\n        var s = [false, false];\n        if (enterID === undefined || enterID >= 0)\n            s[0] = this.off(UIPointerActions.enter, enterID);\n        if (leaveID === undefined || leaveID >= 0)\n            s[1] = this.off(UIPointerActions.leave, leaveID);\n        return s;\n    }\n}\nexport class UIDragger extends UIButton {\n    constructor(group, shape, states = {}, id) {\n        super(group, shape, states, id);\n        this._draggingID = -1;\n        this._moveHoldID = -1;\n        this._dropHoldID = -1;\n        this._upHoldID = -1;\n        if (states.dragging === undefined)\n            this._states['dragging'] = false;\n        if (states.moved === undefined)\n            this._states['moved'] = false;\n        if (states.offset === undefined)\n            this._states['offset'] = new Pt();\n        const UA = UIPointerActions;\n        this.on(UA.down, (target, pt, type, evt) => {\n            if (this._moveHoldID === -1) {\n                this.state('dragging', true);\n                this.state('offset', new Pt(pt).subtract(target.group[0]));\n                this._moveHoldID = this.hold(UA.move);\n            }\n            if (this._dropHoldID === -1) {\n                this._dropHoldID = this.hold(UA.drop);\n            }\n            if (this._upHoldID === -1) {\n                this._upHoldID = this.hold(UA.up);\n            }\n            if (this._draggingID === -1) {\n                this._draggingID = this.on(UA.move, (t, p) => {\n                    if (this.state('dragging')) {\n                        UI._trigger(this._actions[UA.uidrag], t, p, UA.uidrag, evt);\n                        this.state('moved', true);\n                    }\n                });\n            }\n        });\n        const endDrag = (target, pt, type, evt) => {\n            this.state('dragging', false);\n            this.off(UA.move, this._draggingID);\n            this._draggingID = -1;\n            this.unhold(this._moveHoldID);\n            this._moveHoldID = -1;\n            this.unhold(this._dropHoldID);\n            this._dropHoldID = -1;\n            this.unhold(this._upHoldID);\n            this._upHoldID = -1;\n            if (this.state('moved')) {\n                UI._trigger(this._actions[UA.uidrop], target, pt, UA.uidrop, evt);\n                this.state('moved', false);\n            }\n        };\n        this.on(UA.drop, endDrag);\n        this.on(UA.up, endDrag);\n        this.on(UA.out, endDrag);\n    }\n    onDrag(fn) {\n        return this.on(UIPointerActions.uidrag, fn);\n    }\n    offDrag(id) {\n        return this.off(UIPointerActions.uidrag, id);\n    }\n    onDrop(fn) {\n        return this.on(UIPointerActions.uidrop, fn);\n    }\n    offDrop(id) {\n        return this.off(UIPointerActions.uidrop, id);\n    }\n}\n//# sourceMappingURL=UI.js.map"]},"metadata":{},"sourceType":"module"}